# Vikingship ç»„ä»¶åº“é¡¹ç›®ä» 0 åˆ° 1 æ„å»ºæŒ‡å—

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

è¿™æ˜¯ä¸€ä¸ªä½¿ç”¨ **React 18 + TypeScript** ä»é›¶æ„å»ºçš„ç»„ä»¶åº“é¡¹ç›®ï¼Œç±»ä¼¼äº Ant Designã€‚é¡¹ç›®é‡‡ç”¨ç°ä»£åŒ–çš„å‰ç«¯å·¥ç¨‹åŒ–æ–¹æ¡ˆï¼ŒåŒ…å«å®Œæ•´çš„å¼€å‘ã€æµ‹è¯•ã€æ„å»ºå’Œå‘å¸ƒæµç¨‹ã€‚

---

## ğŸš€ ä» 0 åˆ° 1 æ„å»ºæ­¥éª¤è¯¦è§£ï¼ˆé¢è¯•é‡ç‚¹ï¼‰

### ç¬¬ä¸€æ­¥ï¼šé¡¹ç›®åˆå§‹åŒ–

#### 1.1 åˆ›å»ºé¡¹ç›®ç›®å½•å’Œåˆå§‹åŒ– package.json

```bash
# åˆ›å»ºé¡¹ç›®ç›®å½•
mkdir vikingship
cd vikingship

# åˆå§‹åŒ– npm é¡¹ç›®
npm init -y
```

**æŠ€æœ¯ç‚¹**ï¼š
- ä½¿ç”¨ `npm init -y` å¿«é€Ÿåˆ›å»º `package.json`
- åç»­éœ€è¦æ‰‹åŠ¨ä¿®æ”¹ `package.json` ä¸­çš„å­—æ®µ

#### 1.2 é…ç½® package.json åŸºæœ¬ä¿¡æ¯

```json
{
  "name": "vikingship",
  "version": "1.0.0",
  "description": "React components library",
  "main": "dist/index.es.js",        // ESM æ ¼å¼å…¥å£
  "module": "dist/index.es.js",      // æ¨¡å—å…¥å£
  "unpkg": "dist/index.umd.js",     // UMD æ ¼å¼ï¼ˆCDN ä½¿ç”¨ï¼‰
  "types": "dist/index.d.ts",        // TypeScript ç±»å‹å®šä¹‰
  "files": ["dist"],                 // å‘å¸ƒåˆ° npm çš„æ–‡ä»¶
  "sideEffects": ["dist/index.css"]  // æ ‡è®° CSS ä¸ºå‰¯ä½œç”¨
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- **main**: CommonJS å…¥å£ï¼ˆå‘åå…¼å®¹ï¼‰
- **module**: ES Module å…¥å£ï¼ˆç°ä»£æ ‡å‡†ï¼Œæ”¯æŒ Tree Shakingï¼‰
- **types**: TypeScript ç±»å‹å®šä¹‰æ–‡ä»¶ä½ç½®
- **files**: æ§åˆ¶å‘å¸ƒåˆ° npm çš„æ–‡ä»¶èŒƒå›´ï¼Œåªå‘å¸ƒ `dist` ç›®å½•
- **sideEffects**: å‘Šè¯‰æ‰“åŒ…å·¥å…· CSS æ–‡ä»¶æœ‰å‰¯ä½œç”¨ï¼Œä¸èƒ½ Tree Shake

---

### ç¬¬äºŒæ­¥ï¼šæŠ€æœ¯æ ˆé€‰æ‹©å’Œä¾èµ–å®‰è£…

#### 2.1 æ ¸å¿ƒä¾èµ–ï¼ˆdependenciesï¼‰

```bash
npm install react react-dom --save
npm install classnames @fortawesome/react-fontawesome react-transition-group async-validator axios lodash-es --save
```

**æŠ€æœ¯é€‰å‹ç†ç”±**ï¼š

1. **React 18.2.0 + React DOM**
   - ä½¿ç”¨æœ€æ–°ç¨³å®šç‰ˆæœ¬
   - æ”¯æŒ Concurrent Featuresã€Suspense ç­‰æ–°ç‰¹æ€§

2. **classnames**
   - åŠ¨æ€ç»„åˆ CSS ç±»å
   - è§£å†³æ¡ä»¶ç±»åçš„å¯è¯»æ€§é—®é¢˜
   ```typescript
   // ä½¿ç”¨å‰
   className={`btn ${btnType ? `btn-${btnType}` : ''} ${size ? `btn-${size}` : ''}`}
   
   // ä½¿ç”¨å
   className={classNames('btn', {
     [`btn-${btnType}`]: btnType,
     [`btn-${size}`]: size
   })}
   ```

3. **@fortawesome/react-fontawesome**
   - æä¾›å›¾æ ‡åº“æ”¯æŒ
   - SVG å›¾æ ‡ï¼Œä½“ç§¯å°ï¼Œå¯å®šåˆ¶

4. **react-transition-group**
   - ç»„ä»¶è¿‡æ¸¡åŠ¨ç”»
   - æ§åˆ¶åŠ¨ç”»ç”Ÿå‘½å‘¨æœŸ

5. **async-validator**
   - è¡¨å•éªŒè¯åº“
   - æ”¯æŒåŒæ­¥å’Œå¼‚æ­¥éªŒè¯

6. **axios**
   - HTTP è¯·æ±‚åº“ï¼ˆç”¨äº Upload ç»„ä»¶ï¼‰

7. **lodash-es**
   - å·¥å…·å‡½æ•°åº“ï¼ˆES Module ç‰ˆæœ¬ï¼Œæ”¯æŒ Tree Shakingï¼‰

#### 2.2 å¼€å‘ä¾èµ–ï¼ˆdevDependenciesï¼‰

```bash
# TypeScript ç›¸å…³
npm install typescript @types/react @types/react-dom @types/node --save-dev

# æ„å»ºå·¥å…· - Rollup
npm install rollup @rollup/plugin-commonjs @rollup/plugin-node-resolve @rollup/plugin-json @rollup/plugin-replace --save-dev
npm install rollup-plugin-typescript2 rollup-plugin-sass rollup-plugin-terser --save-dev
npm install rollup-plugin-exclude-dependencies-from-bundle --save-dev

# æ ·å¼å¤„ç†
npm install sass --save-dev

# å¼€å‘å·¥å…· - Storybook
npm install storybook @storybook/react @storybook/react-webpack5 @storybook/addon-essentials --save-dev

# æµ‹è¯•å·¥å…·
npm install react-scripts @testing-library/react @testing-library/jest-dom @testing-library/user-event --save-dev

# ä»£ç è´¨é‡
npm install eslint husky rimraf cross-env --save-dev
```

**æŠ€æœ¯é€‰å‹ç†ç”±**ï¼š

1. **Rollup vs Webpack**
   - **é€‰æ‹© Rollup**ï¼šæ›´é€‚åˆåº“çš„æ‰“åŒ…
   - Rollup è¾“å‡ºæ›´å°ã€æ›´å¹²å‡€
   - æ›´å¥½çš„ Tree Shaking æ”¯æŒ
   - Webpack æ›´é€‚åˆåº”ç”¨æ‰“åŒ…

2. **Storybook**
   - ç»„ä»¶å¼€å‘çš„æœ€ä½³å®è·µ
   - ç‹¬ç«‹å¼€å‘ç¯å¢ƒï¼Œä¸ä¾èµ–ä¸»åº”ç”¨
   - è‡ªåŠ¨ç”Ÿæˆæ–‡æ¡£

3. **react-scripts**
   - æä¾› Jest æµ‹è¯•ç¯å¢ƒï¼ˆé›¶é…ç½®ï¼‰
   - æä¾› ESLint é…ç½®

---

### ç¬¬ä¸‰æ­¥ï¼šTypeScript é…ç½®

#### 3.1 åˆ›å»º tsconfig.jsonï¼ˆå¼€å‘é…ç½®ï¼‰

```json
{
  "compilerOptions": {
    "target": "es5",              // ç¼–è¯‘ç›®æ ‡ï¼šES5ï¼ˆå…¼å®¹æ€§ï¼‰
    "lib": ["dom", "dom.iterable", "esnext"],
    "allowJs": true,               // å…è®¸ JS æ–‡ä»¶
    "skipLibCheck": true,          // è·³è¿‡ç±»å‹æ£€æŸ¥ï¼ˆåŠ å¿«ç¼–è¯‘ï¼‰
    "esModuleInterop": true,       // ES æ¨¡å—äº’æ“ä½œ
    "allowSyntheticDefaultImports": true,
    "strict": true,                // ä¸¥æ ¼æ¨¡å¼
    "forceConsistentCasingInFileNames": true,
    "module": "esnext",            // æ¨¡å—ç³»ç»Ÿï¼šESNext
    "moduleResolution": "node",    // æ¨¡å—è§£æç­–ç•¥
    "resolveJsonModule": true,     // æ”¯æŒå¯¼å…¥ JSON
    "isolatedModules": true,       // éš”ç¦»æ¨¡å—
    "noEmit": true,                // ä¸è¾“å‡ºæ–‡ä»¶ï¼ˆå¼€å‘æ—¶ï¼‰
    "jsx": "react",                // JSX å¤„ç†æ–¹å¼
    "noImplicitAny": false         // å…è®¸éšå¼ anyï¼ˆå¼€å‘æ—¶æ”¾å®½ï¼‰
  },
  "include": ["src"]
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- `target: "es5"`: ç¡®ä¿å…¼å®¹æ—§æµè§ˆå™¨
- `module: "esnext"`: ä½¿ç”¨æœ€æ–°çš„æ¨¡å—ç³»ç»Ÿ
- `noEmit: true`: å¼€å‘æ—¶ä¸ç”Ÿæˆæ–‡ä»¶ï¼Œç”±æ„å»ºå·¥å…·å¤„ç†
- `jsx: "react"`: å°† JSX è½¬æ¢ä¸º `React.createElement`

#### 3.2 åˆ›å»º tsconfig.build.jsonï¼ˆæ„å»ºé…ç½®ï¼‰

```json
{
  "compilerOptions": {
    "outDir": "dist",
    "module": "esnext",
    "target": "es5",
    "declaration": true,           // ç”Ÿæˆ .d.ts ç±»å‹å®šä¹‰æ–‡ä»¶
    "jsx": "react",
    "moduleResolution": "node",
    "allowSyntheticDefaultImports": true
  },
  "include": ["src"],
  "exclude": [
    "src/**/*.test.tsx",           // æ’é™¤æµ‹è¯•æ–‡ä»¶
    "src/**/*.stories.tsx",        // æ’é™¤ Storybook æ–‡ä»¶
    "src/setupTests.ts"
  ]
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- `declaration: true`: ç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶ï¼Œä¾›ä½¿ç”¨è€…è·å¾—ç±»å‹æç¤º
- `exclude`: æ’é™¤ä¸éœ€è¦ç¼–è¯‘çš„æ–‡ä»¶

---

### ç¬¬å››æ­¥ï¼šé¡¹ç›®ç›®å½•ç»“æ„æ­å»º

#### 4.1 åˆ›å»ºåŸºç¡€ç›®å½•ç»“æ„

```bash
mkdir -p src/components
mkdir -p src/hooks
mkdir -p src/styles
mkdir -p rollup
mkdir -p .storybook
```

#### 4.2 ç›®å½•ç»“æ„è¯´æ˜

```
vikingship/
â”œâ”€â”€ .storybook/              # Storybook é…ç½®
â”‚   â”œâ”€â”€ main.js            # Storybook ä¸»é…ç½®
â”‚   â””â”€â”€ preview.js         # Storybook é¢„è§ˆé…ç½®ï¼ˆå…¨å±€æ ·å¼ã€å‚æ•°ï¼‰
â”œâ”€â”€ rollup/                 # Rollup æ„å»ºé…ç½®
â”‚   â”œâ”€â”€ rollup.config.js   # åŸºç¡€é…ç½®
â”‚   â”œâ”€â”€ rollup.esm.config.js  # ESM æ ¼å¼é…ç½®
â”‚   â””â”€â”€ rollup.umd.config.js   # UMD æ ¼å¼é…ç½®
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ components/        # ç»„ä»¶ç›®å½•
â”‚   â”‚   â””â”€â”€ Button/       # æ¯ä¸ªç»„ä»¶ä¸€ä¸ªæ–‡ä»¶å¤¹
â”‚   â”‚       â”œâ”€â”€ button.tsx        # ç»„ä»¶å®ç°
â”‚   â”‚       â”œâ”€â”€ button.stories.tsx  # Storybook æ•…äº‹
â”‚   â”‚       â”œâ”€â”€ button.test.tsx   # å•å…ƒæµ‹è¯•
â”‚   â”‚       â”œâ”€â”€ _style.scss       # ç»„ä»¶æ ·å¼
â”‚   â”‚       â””â”€â”€ index.tsx        # å¯¼å‡ºæ–‡ä»¶
â”‚   â”œâ”€â”€ hooks/            # è‡ªå®šä¹‰ Hooks
â”‚   â”œâ”€â”€ styles/           # å…¨å±€æ ·å¼
â”‚   â”‚   â”œâ”€â”€ index.scss    # æ ·å¼å…¥å£
â”‚   â”‚   â”œâ”€â”€ _variables.scss  # æ ·å¼å˜é‡
â”‚   â”‚   â”œâ”€â”€ _mixin.scss   # SCSS æ··å…¥
â”‚   â”‚   â”œâ”€â”€ _reboot.scss  # æ ·å¼é‡ç½®
â”‚   â”‚   â””â”€â”€ _animation.scss  # åŠ¨ç”»
â”‚   â””â”€â”€ index.tsx         # ç»„ä»¶åº“ä¸»å…¥å£
â””â”€â”€ dist/                  # æ„å»ºè¾“å‡ºï¼ˆæ„å»ºåç”Ÿæˆï¼‰
```

**è®¾è®¡åŸåˆ™**ï¼š
- **ç»„ä»¶ç‹¬ç«‹**: æ¯ä¸ªç»„ä»¶ä¸€ä¸ªæ–‡ä»¶å¤¹ï¼ŒåŒ…å«æ‰€æœ‰ç›¸å…³æ–‡ä»¶
- **æ ·å¼åˆ†ç¦»**: ç»„ä»¶æ ·å¼ç‹¬ç«‹ï¼Œå…¨å±€æ ·å¼ç»Ÿä¸€ç®¡ç†
- **ç±»å‹å®‰å…¨**: æ‰€æœ‰æ–‡ä»¶ä½¿ç”¨ TypeScript

---

### ç¬¬äº”æ­¥ï¼šæ ·å¼ç³»ç»Ÿæ­å»º

#### 5.1 åˆ›å»ºæ ·å¼å˜é‡æ–‡ä»¶ `src/styles/_variables.scss`

```scss
// é¢œè‰²ç³»ç»Ÿ
$primary: #0d6efd;
$danger: #dc3545;
$success: #52c41a;
// ... æ›´å¤šé¢œè‰²

// å°ºå¯¸ç³»ç»Ÿ
$font-size-base: 1rem;
$font-size-lg: 1.25rem;
$font-size-sm: 0.875rem;

// é—´è·ç³»ç»Ÿ
$spacing-xs: 4px;
$spacing-sm: 8px;
$spacing-md: 16px;
$spacing-lg: 24px;
```

**æŠ€æœ¯ç‚¹**ï¼š
- ä½¿ç”¨ SCSS å˜é‡ç»Ÿä¸€ç®¡ç†è®¾è®¡ç³»ç»Ÿ
- ä¾¿äºä¸»é¢˜åˆ‡æ¢å’Œå®šåˆ¶

#### 5.2 åˆ›å»ºæ ·å¼æ··å…¥æ–‡ä»¶ `src/styles/_mixin.scss`

```scss
// æŒ‰é’®åŸºç¡€æ ·å¼æ··å…¥
@mixin button-base {
  display: inline-block;
  font-weight: 400;
  text-align: center;
  cursor: pointer;
  // ...
}

// æŒ‰é’®å˜ä½“æ··å…¥
@mixin button-variant($color) {
  background-color: $color;
  border-color: $color;
  &:hover {
    background-color: darken($color, 10%);
  }
}
```

**æŠ€æœ¯ç‚¹**ï¼š
- ä½¿ç”¨ SCSS Mixin å®ç°æ ·å¼å¤ç”¨
- å‡å°‘é‡å¤ä»£ç 

#### 5.3 åˆ›å»ºæ ·å¼å…¥å£æ–‡ä»¶ `src/styles/index.scss`

```scss
// 1. å¯¼å…¥å˜é‡ï¼ˆæœ€å…ˆå¯¼å…¥ï¼Œå…¶ä»–æ–‡ä»¶å¯ä»¥ä½¿ç”¨ï¼‰
@import "variables";

// 2. å¯¼å…¥é‡ç½®æ ·å¼
@import "reboot";

// 3. å¯¼å…¥æ··å…¥
@import "mixin";

// 4. å¯¼å…¥åŠ¨ç”»
@import "animation";

// 5. å¯¼å…¥ç»„ä»¶æ ·å¼ï¼ˆæŒ‰ç»„ä»¶å¯¼å…¥ï¼‰
@import "../components/Button/style";
@import "../components/Input/style";
// ... å…¶ä»–ç»„ä»¶
```

**æŠ€æœ¯ç‚¹**ï¼š
- å¯¼å…¥é¡ºåºå¾ˆé‡è¦ï¼šå˜é‡ â†’ é‡ç½® â†’ æ··å…¥ â†’ åŠ¨ç”» â†’ ç»„ä»¶
- ä½¿ç”¨ `@import` ç»„ç»‡æ ·å¼æ–‡ä»¶

---

### ç¬¬å…­æ­¥ï¼šRollup æ„å»ºé…ç½®

#### 6.1 åˆ›å»ºåŸºç¡€é…ç½® `rollup/rollup.config.js`

```javascript
import typescript from 'rollup-plugin-typescript2'
import { nodeResolve } from '@rollup/plugin-node-resolve'
import commonjs from '@rollup/plugin-commonjs'
import json from '@rollup/plugin-json'
import sass from 'rollup-plugin-sass'

// TypeScript ç¼–è¯‘é…ç½®
const overrides = {
  compilerOptions: { 
    declaration: true  // ç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶
  },
  exclude: [
    "src/**/*.test.tsx",      // æ’é™¤æµ‹è¯•æ–‡ä»¶
    "src/**/*.stories.tsx",   // æ’é™¤ Storybook æ–‡ä»¶
    "src/setupTests.ts"
  ]
}

const config = {
  input: 'src/index.tsx',  // å…¥å£æ–‡ä»¶
  plugins: [
    nodeResolve(),          // è§£æ node_modules ä¸­çš„æ¨¡å—
    commonjs(),             // è½¬æ¢ CommonJS æ¨¡å—ä¸º ES Module
    json(),                 // æ”¯æŒå¯¼å…¥ JSON æ–‡ä»¶
    typescript({ 
      tsconfigOverride: overrides 
    }),                     // TypeScript ç¼–è¯‘
    sass({ 
      output: 'dist/index.css'  // è¾“å‡º CSS æ–‡ä»¶
    })                      // SCSS ç¼–è¯‘
  ],
}

export default config
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š

1. **nodeResolve**: è§£æç¬¬ä¸‰æ–¹æ¨¡å—
   - è§£å†³ `import 'lodash'` è¿™æ ·çš„å¯¼å…¥

2. **commonjs**: è½¬æ¢ CommonJS
   - å°† `require()` è½¬æ¢ä¸º `import`
   - å…¼å®¹ä½¿ç”¨ CommonJS çš„ç¬¬ä¸‰æ–¹åº“

3. **typescript**: TypeScript ç¼–è¯‘
   - ç¼–è¯‘ TS/TSX æ–‡ä»¶
   - ç”Ÿæˆç±»å‹å®šä¹‰æ–‡ä»¶ï¼ˆ`.d.ts`ï¼‰

4. **sass**: SCSS ç¼–è¯‘
   - å°† SCSS ç¼–è¯‘ä¸º CSS
   - è¾“å‡ºåˆ° `dist/index.css`

#### 6.2 åˆ›å»º ESM é…ç½® `rollup/rollup.esm.config.js`

```javascript
import basicConfig from './rollup.config'
import excludeDependenciesFromBundle from "rollup-plugin-exclude-dependencies-from-bundle"

const config = {
  ...basicConfig,
  output: [
    {
      file: 'dist/index.es.js',
      format: 'es',              // ES Module æ ¼å¼
      sourcemap: true            // ç”Ÿæˆ sourcemap
    }
  ],
  plugins: [
    ...basicConfig.plugins,
    excludeDependenciesFromBundle(),  // æ’é™¤ä¾èµ–ï¼Œä¸æ‰“åŒ…åˆ° bundle
  ],
  external: ['react', 'react-dom']     // å¤–éƒ¨ä¾èµ–ï¼Œä¸æ‰“åŒ…
}

export default config
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- **format: 'es'**: è¾“å‡º ES Module æ ¼å¼
- **excludeDependenciesFromBundle**: ä¸æ‰“åŒ…ä¾èµ–ï¼Œå‡å°ä½“ç§¯
- **external**: æ ‡è®°å¤–éƒ¨ä¾èµ–ï¼Œä½¿ç”¨è€…çš„é¡¹ç›®ä¼šæä¾›è¿™äº›ä¾èµ–
- **ä¼˜åŠ¿**: æ”¯æŒ Tree Shakingï¼Œå‡å°åŒ…ä½“ç§¯

#### 6.3 åˆ›å»º UMD é…ç½® `rollup/rollup.umd.config.js`

```javascript
import basicConfig from './rollup.config'
import { terser } from "rollup-plugin-terser"
import replace from '@rollup/plugin-replace'

const config = {
  ...basicConfig,
  output: [
    {
      name: 'Vikingship',        // å…¨å±€å˜é‡å
      file: 'dist/index.umd.js',
      format: 'umd',             // UMD æ ¼å¼
      exports: 'named',          // å‘½åå¯¼å‡º
      globals: {                 // å…¨å±€å˜é‡æ˜ å°„
        'react': 'React',
        'react-dom': 'ReactDOM'
      },
      plugins: [terser()]        // ä»£ç å‹ç¼©
    }
  ],
  plugins: [
    replace({
      'process.env.NODE_ENV': JSON.stringify('production')
    }),
    ...basicConfig.plugins
  ],
  external: ['react', 'react-dom']  // å¤–éƒ¨ä¾èµ–
}

export default config
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- **format: 'umd'**: é€šç”¨æ¨¡å—å®šä¹‰ï¼Œå¯åœ¨æµè§ˆå™¨ç›´æ¥ä½¿ç”¨
- **globals**: æ˜ å°„å¤–éƒ¨ä¾èµ–åˆ°å…¨å±€å˜é‡
- **terser**: ä»£ç å‹ç¼©ï¼Œå‡å°ä½“ç§¯
- **ä½¿ç”¨åœºæ™¯**: CDN å¼•å…¥ã€æµè§ˆå™¨ç›´æ¥ä½¿ç”¨

#### 6.4 é…ç½®æ„å»ºè„šæœ¬

åœ¨ `package.json` ä¸­æ·»åŠ ï¼š

```json
{
  "scripts": {
    "clean": "rimraf ./dist",
    "build-es": "rollup --config rollup/rollup.esm.config.js",
    "build-umd": "rollup --config rollup/rollup.umd.config.js",
    "build-css": "sass ./src/styles/index.scss ./dist/index.css",
    "build": "npm run clean && npm run build-es && npm run build-umd && npm run build-css"
  }
}
```

**æ„å»ºæµç¨‹**ï¼š
1. æ¸…ç†æ—§æ–‡ä»¶
2. æ„å»º ESM æ ¼å¼
3. æ„å»º UMD æ ¼å¼
4. æ„å»º CSS

---

### ç¬¬ä¸ƒæ­¥ï¼šStorybook å¼€å‘ç¯å¢ƒé…ç½®

#### 7.1 åˆå§‹åŒ– Storybook

```bash
npx storybook@latest init
```

#### 7.2 é…ç½® `.storybook/main.js`

```javascript
module.exports = {
  "stories": [
    "../src/**/*.stories.mdx",
    "../src/**/*.stories.@(js|jsx|ts|tsx)"
  ],
  "addons": [
    "@storybook/addon-links",
    "@storybook/addon-essentials",
    "@storybook/addon-interactions"
  ],
  "framework": {
    "name": "@storybook/react-webpack5",
    "options": {}
  }
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- **stories**: Storybook ä¼šè‡ªåŠ¨æŸ¥æ‰¾è¿™äº›æ–‡ä»¶
- **framework**: ä½¿ç”¨ Webpack 5 ä½œä¸ºæ„å»ºå·¥å…·
- **addons**: æ’ä»¶ç³»ç»Ÿï¼Œæä¾›äº¤äº’ã€æ–‡æ¡£ç­‰åŠŸèƒ½

#### 7.3 é…ç½® `.storybook/preview.js`

```javascript
import { library } from '@fortawesome/fontawesome-svg-core'
import { fas } from '@fortawesome/free-solid-svg-icons'
import "../src/styles/index.scss"  // å¯¼å…¥å…¨å±€æ ·å¼

library.add(fas)  // æ·»åŠ å›¾æ ‡åº“

export const parameters = {
  actions: { argTypesRegex: "^on[A-Z].*" },
  controls: {
    matchers: {
      color: /(background|color)$/i,
      date: /Date$/,
    },
  },
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- åœ¨é¢„è§ˆé…ç½®ä¸­å¯¼å…¥å…¨å±€æ ·å¼
- åˆå§‹åŒ–å›¾æ ‡åº“
- é…ç½® Storybook å‚æ•°

---

### ç¬¬å…«æ­¥ï¼šå¼€å‘ç¬¬ä¸€ä¸ªç»„ä»¶ï¼ˆButtonï¼‰

#### 8.1 åˆ›å»º Button ç»„ä»¶ `src/components/Button/button.tsx`

```typescript
import React, { FC, ButtonHTMLAttributes, AnchorHTMLAttributes } from 'react'
import classNames from 'classnames'

// å®šä¹‰ç±»å‹
export type ButtonSize = 'lg' | 'sm'
export type ButtonType = 'primary' | 'default' | 'danger' | 'link'

// åŸºç¡€å±æ€§æ¥å£
interface BaseButtonProps {
  className?: string;
  disabled?: boolean;
  size?: ButtonSize;
  btnType?: ButtonType;
  children: React.ReactNode;
  href?: string;
}

// ç»„åˆç±»å‹
type NativeButtonProps = BaseButtonProps & ButtonHTMLAttributes<HTMLElement>
type AnchorButtonProps = BaseButtonProps & AnchorHTMLAttributes<HTMLElement>
export type ButtonProps = Partial<NativeButtonProps & AnchorButtonProps>

/**
 * Button ç»„ä»¶
 */
export const Button: FC<ButtonProps> = (props) => {
  const { 
    btnType,
    className,
    disabled,
    size,
    children,
    href,
    ...restProps
  } = props
  
  // åŠ¨æ€ç»„åˆç±»å
  const classes = classNames('btn', className, {
    [`btn-${btnType}`]: btnType,
    [`btn-${size}`]: size,
    'disabled': (btnType === 'link') && disabled
  })
  
  // æ ¹æ®ç±»å‹æ¸²æŸ“ä¸åŒå…ƒç´ 
  if (btnType === 'link' && href) {
    return (
      <a
        className={classes}
        href={href}
        {...restProps}
      >
        {children}
      </a>
    )
  } else {
    return (
      <button
        className={classes}
        disabled={disabled}
        {...restProps}
      >
        {children}
      </button>
    )
  }
}

Button.defaultProps = {
  disabled: false,
  btnType: 'default'
}

export default Button
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š

1. **TypeScript ç±»å‹å®šä¹‰**
   - ä½¿ç”¨è”åˆç±»å‹å®šä¹‰å°ºå¯¸å’Œç±»å‹
   - ä½¿ç”¨äº¤å‰ç±»å‹ç»„åˆå±æ€§
   - ä½¿ç”¨ `Partial` ä½¿æ‰€æœ‰å±æ€§å¯é€‰

2. **classNames ä½¿ç”¨**
   - åŠ¨æ€ç»„åˆ CSS ç±»å
   - æ¡ä»¶ç±»åæ›´æ¸…æ™°

3. **å¤šæ€ç»„ä»¶**
   - æ ¹æ® `btnType` æ¸²æŸ“ `<button>` æˆ– `<a>`
   - ä½¿ç”¨ç±»å‹å®ˆå«ç¡®ä¿ç±»å‹å®‰å…¨

4. **defaultProps**
   - è®¾ç½®é»˜è®¤å€¼
   - React 18 ä¸­ä»å¯ä½¿ç”¨ï¼ˆå‡½æ•°ç»„ä»¶ï¼‰

#### 8.2 åˆ›å»ºç»„ä»¶æ ·å¼ `src/components/Button/_style.scss`

```scss
.btn {
  display: inline-block;
  font-weight: 400;
  text-align: center;
  cursor: pointer;
  border: 1px solid transparent;
  padding: 0.375rem 0.75rem;
  font-size: 1rem;
  border-radius: 0.25rem;
  transition: color 0.15s ease-in-out;
  
  // å°ºå¯¸å˜ä½“
  &.btn-lg {
    padding: 0.5rem 1rem;
    font-size: 1.25rem;
  }
  
  &.btn-sm {
    padding: 0.25rem 0.5rem;
    font-size: 0.875rem;
  }
  
  // ç±»å‹å˜ä½“
  &.btn-primary {
    color: #fff;
    background-color: $primary;
    border-color: $primary;
    
    &:hover {
      background-color: darken($primary, 10%);
    }
  }
  
  &.btn-danger {
    color: #fff;
    background-color: $danger;
    border-color: $danger;
  }
  
  &.btn-link {
    font-weight: 400;
    color: $primary;
    text-decoration: underline;
    background-color: transparent;
    border: none;
  }
  
  // ç¦ç”¨çŠ¶æ€
  &:disabled,
  &.disabled {
    opacity: 0.65;
    cursor: not-allowed;
  }
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- ä½¿ç”¨ BEM å‘½åè§„èŒƒ
- ä½¿ç”¨ SCSS å˜é‡å’Œå‡½æ•°ï¼ˆ`darken`ï¼‰
- ä½¿ç”¨åµŒå¥—é€‰æ‹©å™¨ç»„ç»‡æ ·å¼

#### 8.3 åˆ›å»ºå¯¼å‡ºæ–‡ä»¶ `src/components/Button/index.tsx`

```typescript
import Button from './button'
export default Button
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- ç»Ÿä¸€å¯¼å‡ºæ¥å£
- ä¾¿äºåç»­é‡æ„

#### 8.4 åˆ›å»º Storybook æ•…äº‹ `src/components/Button/button.stories.tsx`

```typescript
import React from 'react'
import { ComponentStory, ComponentMeta } from '@storybook/react'
import Button from './button'

export default {
  title: 'ç¬¬å››ç« ï¼šButton',
  component: Button,
} as ComponentMeta<typeof Button>

const Template: ComponentStory<typeof Button> = (args) => <Button {...args} />

export const Default = Template.bind({})
Default.args = {
  children: 'Default Button',
}

export const ButtonWithSize = () => (
  <>
    <Button size="lg">large button</Button>
    <Button size="sm">small button</Button>
  </>
)

export const ButtonWithType = () => (
  <>
    <Button btnType="primary">primary button</Button>
    <Button btnType="danger">danger button</Button>
    <Button btnType="link" href="https://google.com">link button</Button>
  </>
)
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- Storybook è‡ªåŠ¨è¯†åˆ« `.stories.tsx` æ–‡ä»¶
- ä½¿ç”¨ Template æ¨¡å¼å¤ç”¨ç»„ä»¶
- å±•ç¤ºç»„ä»¶çš„ä¸åŒçŠ¶æ€

#### 8.5 åˆ›å»ºå•å…ƒæµ‹è¯• `src/components/Button/button.test.tsx`

```typescript
import React from 'react'
import { render, fireEvent } from '@testing-library/react'
import Button from './button'

describe('test Button component', () => {
  it('should render the correct default button', () => {
    const onClick = jest.fn()
    const wrapper = render(<Button onClick={onClick}>Nice</Button>)
    const element = wrapper.getByText('Nice') as HTMLButtonElement
    
    expect(element).toBeInTheDocument()
    expect(element.tagName).toEqual('BUTTON')
    expect(element).toHaveClass('btn btn-default')
    
    fireEvent.click(element)
    expect(onClick).toHaveBeenCalled()
  })
  
  it('should render disabled button when disabled set to true', () => {
    const onClick = jest.fn()
    const wrapper = render(<Button disabled onClick={onClick}>Nice</Button>)
    const element = wrapper.getByText('Nice') as HTMLButtonElement
    
    expect(element.disabled).toBeTruthy()
    fireEvent.click(element)
    expect(onClick).not.toHaveBeenCalled()
  })
})
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- ä½¿ç”¨ React Testing Libraryï¼ˆæ¨èæ–¹å¼ï¼‰
- æµ‹è¯•ç”¨æˆ·è¡Œä¸ºï¼Œè€Œéå®ç°ç»†èŠ‚
- ä½¿ç”¨ `jest.fn()` æ¨¡æ‹Ÿå‡½æ•°

#### 8.6 åœ¨ä¸»å…¥å£å¯¼å‡ºç»„ä»¶ `src/index.tsx`

```typescript
import './styles/index.scss'  // å¯¼å…¥å…¨å±€æ ·å¼

export { default as Button } from './components/Button'
// åç»­æ·»åŠ å…¶ä»–ç»„ä»¶...
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- ç»Ÿä¸€å¯¼å‡ºæ‰€æœ‰ç»„ä»¶
- å¯¼å…¥å…¨å±€æ ·å¼ï¼ˆæ„å»ºæ—¶ä¼šæ‰“åŒ…ï¼‰

---

### ç¬¬ä¹æ­¥ï¼šæµ‹è¯•ç³»ç»Ÿé…ç½®

#### 9.1 é…ç½®æµ‹è¯•ç¯å¢ƒ `src/setupTests.ts`

```typescript
import '@testing-library/jest-dom/extend-expect'
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- æ‰©å±• Jest çš„åŒ¹é…å™¨
- æä¾› `toBeInTheDocument()` ç­‰ DOM åŒ¹é…å™¨

#### 9.2 é…ç½®æµ‹è¯•è„šæœ¬

```json
{
  "scripts": {
    "test": "react-scripts test",
    "test:nowatch": "cross-env CI=true react-scripts test"
  }
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- `react-scripts test`: æä¾› Jest ç¯å¢ƒ
- `CI=true`: å•æ¬¡è¿è¡Œæ¨¡å¼ï¼ˆç”¨äº CI/CDï¼‰

---

### ç¬¬åæ­¥ï¼šä»£ç è´¨é‡å·¥å…·é…ç½®

#### 10.1 ESLint é…ç½®

```json
{
  "eslintConfig": {
    "extends": "react-app"
  },
  "scripts": {
    "lint": "eslint --ext js,ts,tsx src --max-warnings 5"
  }
}
```

#### 10.2 Husky Git Hooks é…ç½®

```json
{
  "husky": {
    "hooks": {
      "pre-commit": "npm run test:nowatch && npm run lint"
    }
  }
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- æäº¤å‰è‡ªåŠ¨è¿è¡Œæµ‹è¯•å’Œä»£ç æ£€æŸ¥
- ç¡®ä¿ä»£ç è´¨é‡

---

### ç¬¬åä¸€æ­¥ï¼šå‘å¸ƒé…ç½®

#### 11.1 é…ç½®å‘å¸ƒå‰æ£€æŸ¥

```json
{
  "scripts": {
    "prepublishOnly": "npm run test:nowatch && npm run lint && npm run build"
  }
}
```

**æŠ€æœ¯ç‚¹è¯´æ˜**ï¼š
- `prepublishOnly`: npm å‘å¸ƒå‰è‡ªåŠ¨æ‰§è¡Œ
- ç¡®ä¿å‘å¸ƒå‰æµ‹è¯•é€šè¿‡ã€ä»£ç æ£€æŸ¥é€šè¿‡ã€æ„å»ºæˆåŠŸ

#### 11.2 å‘å¸ƒåˆ° npm

```bash
# ç™»å½• npm
npm login

# å‘å¸ƒ
npm publish
```

**å‘å¸ƒæµç¨‹**ï¼š
1. è‡ªåŠ¨è¿è¡Œ `prepublishOnly` è„šæœ¬
2. è¿è¡Œæµ‹è¯•
3. ä»£ç æ£€æŸ¥
4. æ„å»ºé¡¹ç›®
5. å‘å¸ƒåˆ° npm

---

## ğŸ¯ é¢è¯•é‡ç‚¹æŠ€æœ¯ç‚¹æ€»ç»“

### 1. ä¸ºä»€ä¹ˆé€‰æ‹© Rollup è€Œä¸æ˜¯ Webpackï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- Rollup æ›´é€‚åˆåº“çš„æ‰“åŒ…ï¼ˆè¾“å‡ºæ›´å°ã€æ›´å¹²å‡€ï¼‰
- æ›´å¥½çš„ Tree Shaking æ”¯æŒ
- Webpack æ›´é€‚åˆåº”ç”¨æ‰“åŒ…ï¼ˆåŠŸèƒ½æ›´å…¨ä½†ä½“ç§¯æ›´å¤§ï¼‰

### 2. ä¸ºä»€ä¹ˆåŒæ—¶è¾“å‡º ESM å’Œ UMD æ ¼å¼ï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- **ESM**: ç°ä»£æ ‡å‡†ï¼Œæ”¯æŒ Tree Shakingï¼Œé€‚åˆç°ä»£æ‰“åŒ…å·¥å…·
- **UMD**: å…¼å®¹æ€§å¥½ï¼Œå¯åœ¨æµè§ˆå™¨ç›´æ¥ä½¿ç”¨ï¼Œé€‚åˆ CDN

### 3. å¦‚ä½•å¤„ç†æ ·å¼ï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- ä½¿ç”¨ SCSS ç»„ç»‡æ ·å¼ï¼ˆå˜é‡ã€æ··å…¥ã€åµŒå¥—ï¼‰
- ç»„ä»¶æ ·å¼ç‹¬ç«‹ï¼Œå…¨å±€æ ·å¼ç»Ÿä¸€ç®¡ç†
- æ„å»ºæ—¶ç¼–è¯‘ä¸ºå•ä¸ª CSS æ–‡ä»¶

### 4. å¦‚ä½•ä¿è¯ç±»å‹å®‰å…¨ï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- ä½¿ç”¨ TypeScript ç¼–å†™æ‰€æœ‰ä»£ç 
- ç”Ÿæˆ `.d.ts` ç±»å‹å®šä¹‰æ–‡ä»¶
- ä½¿ç”¨è€…å¯ä»¥è·å¾—å®Œæ•´çš„ç±»å‹æç¤º

### 5. å¦‚ä½•å®ç° Tree Shakingï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- ä½¿ç”¨ ES Module æ ¼å¼
- ç»„ä»¶ç‹¬ç«‹å¯¼å‡ºï¼ˆ`export { Button }`ï¼‰
- ä¸æ‰“åŒ…ä¾èµ–åˆ° bundle ä¸­
- ä½¿ç”¨è€…çš„æ‰“åŒ…å·¥å…·ä¼šè‡ªåŠ¨ Tree Shake

### 6. ç»„ä»¶è®¾è®¡åŸåˆ™ï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- **å•ä¸€èŒè´£**: æ¯ä¸ªç»„ä»¶åªåšä¸€ä»¶äº‹
- **å¯å¤ç”¨**: é€šè¿‡ props å®šåˆ¶è¡Œä¸º
- **ç±»å‹å®‰å…¨**: å®Œæ•´çš„ TypeScript ç±»å‹å®šä¹‰
- **å¯æµ‹è¯•**: æ˜“äºç¼–å†™å•å…ƒæµ‹è¯•

### 7. å¦‚ä½•å¤„ç†å—æ§å’Œéå—æ§ç»„ä»¶ï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- æ”¯æŒå—æ§æ¨¡å¼ï¼ˆé€šè¿‡ `value` propï¼‰
- æ”¯æŒéå—æ§æ¨¡å¼ï¼ˆé€šè¿‡ `defaultValue` propï¼‰
- ä½¿ç”¨ `forwardRef` æ”¯æŒ ref è½¬å‘

### 8. å¦‚ä½•å®ç°ç»„ä»¶ç»„åˆï¼Ÿ

**å›ç­”è¦ç‚¹**ï¼š
- ä½¿ç”¨ `children` prop å®ç°å†…å®¹ç»„åˆ
- ä½¿ç”¨å¤šä¸ªå­ç»„ä»¶ï¼ˆå¦‚ Menu + MenuItem + SubMenuï¼‰
- ä½¿ç”¨ Context API åœ¨ç»„ä»¶é—´å…±äº«çŠ¶æ€

---

## ğŸ“š åç»­æ‰©å±•

### æ·»åŠ æ›´å¤šç»„ä»¶

æŒ‰ç…§ Button çš„æ¨¡å¼ï¼Œä¾æ¬¡æ·»åŠ ï¼š
1. Icon ç»„ä»¶
2. Input ç»„ä»¶
3. Alert ç»„ä»¶
4. Menu ç»„ä»¶ï¼ˆå¤æ‚ç»„ä»¶ï¼Œæ¶‰åŠç»„åˆï¼‰
5. Form ç»„ä»¶ï¼ˆæœ€å¤æ‚ï¼Œæ¶‰åŠéªŒè¯ã€çŠ¶æ€ç®¡ç†ï¼‰

### æ€§èƒ½ä¼˜åŒ–

1. **ä»£ç åˆ†å‰²**: æŒ‰éœ€åŠ è½½ç»„ä»¶
2. **æ‡’åŠ è½½**: ä½¿ç”¨ `React.lazy()`
3. **Memo ä¼˜åŒ–**: ä½¿ç”¨ `React.memo()` é¿å…ä¸å¿…è¦çš„é‡æ¸²æŸ“

### æ–‡æ¡£å®Œå–„

1. ä½¿ç”¨ Storybook ç”Ÿæˆæ–‡æ¡£ç«™ç‚¹
2. æ·»åŠ  JSDoc æ³¨é‡Š
3. ä½¿ç”¨ react-docgen è‡ªåŠ¨ç”Ÿæˆ API æ–‡æ¡£

---

ç¥ä½ é¢è¯•é¡ºåˆ©ï¼ğŸš€
